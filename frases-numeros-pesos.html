<!DOCTYPE html>
<html lang="es">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Espa√±ol by Catalina Moreno</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@400;500;700&display=swap');
        body {
            font-family: 'Inter', sans-serif;
            margin: 0;
            padding: 20px;
            background-color: #f5f5f5;
        }
        .quiz-wrapper {
            max-width: 950px !important;
            margin: auto;
        }
        /* Usa un enfoque m√°s robusto para los m√°rgenes en m√≥vil */
        @media (max-width: 767px) {
            .quiz-wrapper {
                max-width: calc(100% - 20px) !important;
                margin: 0 auto !important;
            }
        }
        .mic-button {
            transition: all 0.2s ease-in-out;
        }
        .mic-button:hover {
            transform: scale(1.05);
        }
        .recording-pulse {
            animation: pulse 1.5s infinite;
        }
        .repeat-bounce {
            animation: bounce-repeat 2s infinite;
        }
        @keyframes pulse {
            0% { transform: scale(1); opacity: 1; }
            50% { transform: scale(1.1); opacity: 0.7; }
            100% { transform: scale(1); opacity: 1; }
        }
        @keyframes bounce-repeat {
            0%, 20%, 50%, 80%, 100% { transform: translateY(0); }
            40% { transform: translateY(-10px); }
            60% { transform: translateY(-5px); }
        }
    </style>
</head>
<body>
    <div class='quiz-wrapper bg-white p-8 w-full text-center flex flex-col justify-between border border-gray-300 md:rounded-xl md:shadow-2xl'>
        <div>
            <br>
            <h2 class="text-2xl font-bold mb-4" id="quiz-title">EJERCICIO DE ESPA√ëOL</h2>
            
            <p><strong>Clic, habla y espera el resultado</strong><br><span class='text-red-600'>‚Üì Lee esta frase ‚Üì</span><br>(16 FRASES)<br><br></p>
            
            <div id='question-container'>
                <p id='verb-question' class='text-[24px] font-extrabold text-blue-600 mb-4 leading-[1.60]'>Formato de la pregunta</p>
            </div>

            <div class='flex items-center justify-center space-x-4 mb-6' id='button-container'>
                <button id='mic-button' class='mic-button px-6 py-3 rounded-full bg-red-600 text-white font-bold shadow-lg transition-colors duration-200 focus:outline-none focus:ring-4 focus:ring-blue-300 flex items-center gap-2'>
                    <span>Click & Habla</span>
                    <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                        <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path>
                    </svg>
                </button>
            </div>
            
            <div id='feedback-message' class='h-6 mt-4'>
                <!-- Los mensajes de feedback se mostrar√°n aqu√≠ -->
            </div>
            
            <div class='mb-6'>
                <p id='recognized-text' class='text-[24px] text-gray-700 font-semibold min-w-0 break-words h-auto'></p>
            </div>
        </div>

        <button id='next-button' class='mt-8 px-6 py-3 bg-gray-200 text-white font-bold rounded-full hover:bg-gray-300 transition-colors duration-200 focus:outline-none'>Siguiente ></button>

        <!-- Contenedor para el modal de error -->
        <div id='error-modal' class='fixed inset-0 bg-gray-600 bg-opacity-50 hidden items-center justify-center z-50'>
            <div class='bg-white p-6 rounded-lg shadow-xl text-center max-w-md mx-4'>
                <h3 class='text-xl font-bold text-red-600 mb-4'>Error Detectado</h3>
                <div id='error-details' class='text-gray-700 mb-6 text-left bg-gray-100 p-3 rounded text-sm'>
                    <!-- Los detalles del error aparecer√°n aqu√≠ -->
                </div>
                <p class='text-sm text-gray-600 mb-4'>Por favor, revisa la configuraci√≥n de tu micr√≥fono y permisos del navegador.</p>
                <button id='close-modal' class='px-4 py-2 bg-red-600 text-white font-bold rounded-full hover:bg-red-700 transition-colors'>Cerrar</button>
            </div>
        </div>
    </div>

    <script>
        document.addEventListener('DOMContentLoaded', () => {
            // ===== CONFIGURACI√ìN DEL QUIZ =====
            const QUIZ_CONFIG = {
                titulo: "Mimmo y Tery - numeros", // CAMBIA ESTO CADA SEMANA üü°üü°üü°üü°üü°üü°üü°
                fecha: "20 de noviembre de 2025",    // CAMBIA ESTO CADA SEMANA üü°üü°üü°üü°üü°üü°üü°
				googleFormUrl: 'https://docs.google.com/forms/d/e/1FAIpQLScKfHfxZjiADQacWmRK8Rh4oE8gGFWTTZDuYIc_FzeIM0THog/formResponse',
				entryId: 'entry.876698263'
            };
            
            // Funci√≥n para registrar actividad del quiz
            function registrarActividad(accion) {
                const timestamp = new Date().toLocaleString('es-ES');
                const dispositivo = /Mobile|Android|iPhone|iPad/.test(navigator.userAgent) ? 'M√≥vil' : 'Escritorio';
                const navegador = navigator.userAgent.includes('Chrome') ? 'Chrome' : 
                                 navigator.userAgent.includes('Firefox') ? 'Firefox' : 
                                 navigator.userAgent.includes('Safari') ? 'Safari' : 'Otro';
                
                const mensaje = `${QUIZ_CONFIG.titulo} | ${accion} | ${timestamp} | ${dispositivo} | ${navegador}`;
                
                if (QUIZ_CONFIG.googleFormUrl && QUIZ_CONFIG.entryId) {
                    const formData = new FormData();
                    formData.append(QUIZ_CONFIG.entryId, mensaje);
                    
                    fetch(QUIZ_CONFIG.googleFormUrl, {
                        method: 'POST',
                        mode: 'no-cors',
                        body: formData
                    }).catch(() => {
                        console.log('Registro no enviado');
                    });
                }
            }

            // Lista de preguntas y respuestas üü°üü°üü°üü°üü°üü°üü°üü°üü°
            const verbExercises = [
			

  {
    "question": "Son 12.000 pesos",
    "correctAnswers": [
      "Son doce mil pesos",
      "Son 12000 pesos"
    ]
  },
  {
    "question": "Son 18.000 pesos",
    "correctAnswers": [
      "Son dieciocho mil pesos",
      "Son 18000 pesos"
    ]
  },
  {
    "question": "Son 10.000 pesos",
    "correctAnswers": [
      "Son diez mil pesos",
      "Son 10000 pesos"
    ]
  },
  {
    "question": "Son 20.000 pesos",
    "correctAnswers": [
      "Son veinte mil pesos",
      "Son 20000 pesos"
    ]
  },
  {
    "question": "Son 5.000 pesos",
    "correctAnswers": [
      "Son cinco mil pesos",
      "Son 5000 pesos"
    ]
  },
  {
    "question": "Cuesta 25.000 pesos",
    "correctAnswers": [
      "Cuesta veinticinco mil pesos",
      "Cuesta 25000 pesos"
    ]
  },
  {
    "question": "Cuesta 3.000 pesos",
    "correctAnswers": [
      "Cuesta tres mil pesos",
      "Cuesta 3000 pesos"
    ]
  },
  {
    "question": "Cuesta 9.000 pesos",
    "correctAnswers": [
      "Cuesta nueve mil pesos",
      "Cuesta 9000 pesos"
    ]
  },
  {
    "question": "Cuesta 16.000 pesos",
    "correctAnswers": [
      "Cuesta diecis√©is mil pesos",
      "Cuesta 16000 pesos"
    ]
  },
  {
    "question": "Cuesta 18.000 pesos",
    "correctAnswers": [
      "Cuesta dieciocho mil pesos",
      "Cuesta 18000 pesos"
    ]
  },
  {
    "question": "Cuesta 8.000 pesos",
    "correctAnswers": [
      "Cuesta ocho mil pesos",
      "Cuesta 8000 pesos"
    ]
  },
  {
    "question": "Cuesta 7.000 pesos",
    "correctAnswers": [
      "Cuesta siete mil pesos",
      "Cuesta 7000 pesos"
    ]
  },
  {
    "question": "Tengo 30.000 pesos",
    "correctAnswers": [
      "Tengo treinta mil pesos",
      "Tengo 30000 pesos"
    ]
  },
  {
    "question": "Tengo 15.000 pesos",
    "correctAnswers": [
      "Tengo quince mil pesos",
      "Tengo 15000 pesos"
    ]
  },
  {
    "question": "No tengo 2.000 pesos",
    "correctAnswers": [
      "No tengo dos mil pesos",
      "No tengo 2000 pesos"
    ]
  },
  {
    "question": "No tengo 5.000 pesos",
    "correctAnswers": [
      "No tengo cinco mil pesos",
      "No tengo 5000 pesos"
    ]
  }

				
            ];

            let currentExerciseIndex = 0;
            const verbQuestionElement = document.getElementById('verb-question');
            const micButton = document.getElementById('mic-button');
            const recognizedTextElement = document.getElementById('recognized-text');
            const feedbackMessageElement = document.getElementById('feedback-message');
            const nextButton = document.getElementById('next-button');
            const errorModal = document.getElementById('error-modal');
            const closeModalButton = document.getElementById('close-modal');

            let recognition = null;
            let isRecognizing = false;

           	// Sonidos ultra suaves para quiz
			function playSound(frequency, duration, volume = 0.05) {
			    try {
			        const ctx = new (window.AudioContext || window.webkitAudioContext)();
			        const osc = ctx.createOscillator();
			        const gain = ctx.createGain();
			        const filter = ctx.createBiquadFilter();
        
			        filter.type = 'lowpass';
			        filter.frequency.value = 800;
        
			        osc.connect(filter);
			        filter.connect(gain);
			        gain.connect(ctx.destination);
        
			        osc.type = 'sine';
			        osc.frequency.value = frequency;
        
			        gain.gain.setValueAtTime(0, ctx.currentTime);
			        gain.gain.linearRampToValueAtTime(volume, ctx.currentTime + 0.1);
			        gain.gain.linearRampToValueAtTime(0, ctx.currentTime + duration / 1000);
        
			        osc.start();
			        osc.stop(ctx.currentTime + duration / 1000);
			    } catch (e) {
			        console.log('Audio no disponible');
			    }
			}

			// ===== TUS 4 SONIDOS (cambia frequency y volumen aqu√≠) =====
			function playClickSound() {
			    playSound(350, 200, 0.03);
			}

			function playCorrectSound() {
			    playSound(880, 200, 0.05);
			}

			function playErrorSound() {
			    playSound(350, 400, 0.05);
			    setTimeout(() => playSound(300, 400, 0.04), 150);
			}

			function playFinalSound() {
			    playSound(440, 200, 0.05);
			    setTimeout(() => playSound(554, 200, 0.08), 150);
			    setTimeout(() => playSound(659, 200, 0.09), 300);
			    setTimeout(() => playSound(880, 400, 0.10), 450);
			}

            // Inicia la API de reconocimiento de voz si est√° disponible
            const SpeechRecognition = window.SpeechRecognition || window.webkitSpeechRecognition;

            if (SpeechRecognition) {
                try {
                    recognition = new SpeechRecognition();
                    recognition.lang = 'es-ES'; // Establece el idioma a espa√±ol
                    recognition.interimResults = false;
                    recognition.continuous = false;
                } catch (error) {
                    console.error('Error inicializando SpeechRecognition:', error);
                    recognition = null;
                }
            } else {
                console.error('SpeechRecognition no disponible en este navegador');
            }

            // Solo asignar eventos si recognition fue inicializado correctamente
            if (recognition) {
                // Maneja el resultado del reconocimiento de voz
                recognition.onresult = (event) => {
                    const speechResult = event.results[0][0].transcript;
                    recognizedTextElement.textContent = speechResult;
                    checkAnswer(speechResult);
                };

                // Maneja el final del reconocimiento
                recognition.onend = () => {
                    isRecognizing = false;
                    micButton.classList.remove('bg-red-500', 'recording-pulse');
                    micButton.classList.add('bg-red-600');
                    micButton.disabled = false; // Habilita el bot√≥n al finalizar
                    if (feedbackMessageElement.textContent !== '' && nextButton.textContent === 'Siguiente >') {
                        micButton.innerHTML = `<span>Repite - Click</span>
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path>
                            </svg>`;
                    }
                };

                // Maneja errores de reconocimiento
                recognition.onerror = (event) => {
                    isRecognizing = false;
                    micButton.classList.remove('bg-red-500', 'recording-pulse');
                    micButton.classList.add('bg-red-600');
                    micButton.innerHTML = `<span>Click & Habla</span>
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path>
                        </svg>`;
                    micButton.disabled = false;
            
                    // Mostrar error espec√≠fico seg√∫n el tipo
                    if (event.error === 'not-allowed') {
                        showErrorModal('permission_denied');
                    } else {
                        showErrorModal('recognition_error', event.error);
                    }
            
                    console.error('Speech recognition error: ', event.error);
                };
            }
            
            // Funci√≥n para barajar el array de ejercicios (Fisher-Yates shuffle)
            function shuffleArray(array) {
                for (let i = array.length - 1; i > 0; i--) {
                    const j = Math.floor(Math.random() * (i + 1));
                    [array[i], array[j]] = [array[j], array[i]];
                }
            }

            // Muestra la pregunta actual
            function displayCurrentQuestion() {
                // Actualizar el t√≠tulo del quiz
                document.getElementById('quiz-title').textContent = `Clase del ${QUIZ_CONFIG.fecha}`;
                
                if (currentExerciseIndex < verbExercises.length) {
                    verbQuestionElement.textContent = verbExercises[currentExerciseIndex].question;
                    recognizedTextElement.textContent = '';
                    recognizedTextElement.classList.remove('text-red-600', 'text-green-600');
                    recognizedTextElement.classList.add('text-gray-700');
                    feedbackMessageElement.textContent = '';
                    nextButton.disabled = true; // Deshabilita el bot√≥n siguiente
                    nextButton.classList.remove('bg-red-600', 'text-white', 'hover:bg-red-700', 'shadow-lg');
                    nextButton.classList.add('bg-gray-200', 'text-white', 'hover:bg-gray-300', 'opacity-50', 'cursor-not-allowed');
                    nextButton.textContent = 'Siguiente >';
                    micButton.classList.remove('hidden', 'repeat-bounce'); // Quitar animaci√≥n al mostrar nueva pregunta
                    micButton.innerHTML = `<span>Click & Habla</span>
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path>
                        </svg>`;
                    micButton.disabled = false; // Habilita el bot√≥n del micr√≥fono
                } else {
                    // Fin del ejercicio - registrar completado
                    registrarActividad('COMPLETADO');
                    
                    verbQuestionElement.innerHTML = '<span style="font-size: 2em;">üéâü•≥</span><br>¬°ENHORABUENA!<br>Has contestado correctamente<br>a todas las preguntas.';
                    recognizedTextElement.textContent = '';
                    feedbackMessageElement.textContent = '';
                    micButton.classList.add('hidden');
                    nextButton.classList.remove('bg-gray-200', 'text-gray-700', 'hover:bg-gray-300', 'opacity-50', 'cursor-not-allowed');
                    nextButton.classList.add('bg-red-600', 'text-white', 'hover:bg-red-700', 'shadow-lg');
                    nextButton.textContent = 'Repetir el ejercicio';
                    nextButton.disabled = false;
                    playFinalSound();
                    
                    nextButton.onclick = () => {
                        currentExerciseIndex = 0;
                        shuffleArray(verbExercises); // Baraja de nuevo al reiniciar
                        displayCurrentQuestion();
                        nextButton.onclick = null; // Reinicia el evento de clic
                    };
                }
            }

            // Verifica si la respuesta es correcta (modificado para m√∫ltiples respuestas)
            function checkAnswer(userAnswer) {
                const currentExercise = verbExercises[currentExerciseIndex];
                
                // Se limpia la respuesta del usuario
                const cleanedUserAnswer = userAnswer
                    .toLowerCase().trim()
                    .replace(/[.?!,¬ø¬°]/g, '')
                    .replace(/\s+/g, ' ')
                    .normalize('NFD').replace(/[\u0300-\u036f]/g, '');
                
                // Se verifica contra todas las respuestas correctas posibles
                const isCorrect = currentExercise.correctAnswers.some(correctAnswer => {
                    const cleanedCorrectAnswer = correctAnswer
                        .toLowerCase().trim()
                        .replace(/[.?!,¬ø¬°]/g, '')
                        .replace(/\s+/g, ' ')
                        .normalize('NFD').replace(/[\u0300-\u036f]/g, '');
                    
                    return cleanedUserAnswer === cleanedCorrectAnswer;
                });
                
                // Comparaci√≥n de la respuesta
                if (isCorrect) {
                    // Mostrar la respuesta correcta formateada
                    recognizedTextElement.textContent = currentExercise.correctAnswers[0];
                    recognizedTextElement.classList.remove('text-red-600');
                    recognizedTextElement.classList.add('text-green-600');
                    showFeedback('¬°Correcto! ‚ò∫Ô∏è', true);
                    nextButton.disabled = false; // Habilita el bot√≥n siguiente
                    nextButton.classList.remove('opacity-50', 'cursor-not-allowed', 'bg-gray-200', 'text-gray-700', 'hover:bg-gray-300');
                    nextButton.classList.add('bg-red-600', 'text-white', 'hover:bg-red-700', 'shadow-lg');
                    nextButton.textContent = 'Siguiente >'; // Asegura que el bot√≥n vuelva a 'Siguiente >'
                    micButton.classList.add('hidden');
                    playCorrectSound();
                } else {
                    recognizedTextElement.classList.remove('text-gray-700', 'text-green-600');
                    recognizedTextElement.classList.add('text-red-600');
                    showFeedback('No entiendo, repite por favor. üòï', false);
                    micButton.innerHTML = `<span>Repite - Click</span>
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path>
                        </svg>`;
                    // Agregar animaci√≥n de rebote al bot√≥n "Repite - Click" para que sea m√°s obvio
                    micButton.classList.add('repeat-bounce');
                    nextButton.disabled = false;
                    nextButton.classList.remove('opacity-50', 'cursor-not-allowed', 'bg-gray-200', 'text-gray-700', 'hover:bg-gray-300');
                    nextButton.classList.add('bg-green-600', 'text-white', 'hover:bg-green-700', 'shadow-lg');
                    nextButton.textContent = 'Ayuda';
                    playErrorSound();
                }
            }

            // Muestra el mensaje de retroalimentaci√≥n
            function showFeedback(message, isCorrect) {
                feedbackMessageElement.textContent = message;
                if (isCorrect) {
                    feedbackMessageElement.className = 'text-green-600 font-bold';
                } else {
                    feedbackMessageElement.className = 'text-red-600 font-bold';
                }
            }

            // Muestra el modal de error
            function showErrorModal(errorType, errorDetails = '') {
                const errorDetailsElement = document.getElementById('error-details');
                const timestamp = new Date().toLocaleString('es-ES');
        
                let errorMessage = '';
        
                switch(errorType) {
                    case 'no_speech_api':
                        errorMessage = `‚ùå API de voz no disponible
    üåê Navegador: ${navigator.userAgent}
    ‚è∞ Hora: ${timestamp}
    üì± Dispositivo: ${/Mobile|Android|iPhone|iPad/.test(navigator.userAgent) ? 'M√≥vil' : 'Escritorio'}

    Soluci√≥n: Usa Chrome, Edge o Safari actualizado`;
                        break;
                
                    case 'permission_denied':
                        errorMessage = `üö´ Permisos de micr√≥fono denegados
    ‚è∞ Hora: ${timestamp}
    üì± Dispositivo: ${/Mobile|Android|iPhone|iPad/.test(navigator.userAgent) ? 'M√≥vil' : 'Escritorio'}

    Soluci√≥n: Permite el acceso al micr√≥fono en la configuraci√≥n del navegador`;
                        break;
                
                    case 'recognition_error':
                        errorMessage = `‚ö†Ô∏è Error de reconocimiento de voz
    üîç Tipo: ${errorDetails}
    ‚è∞ Hora: ${timestamp}
    üì± Dispositivo: ${/Mobile|Android|iPhone|iPad/.test(navigator.userAgent) ? 'M√≥vil' : 'Escritorio'}

    Prueba hablar m√°s claro o verificar el micr√≥fono`;
                        break;
                
                    case 'start_error':
                        errorMessage = `üî¥ Error al iniciar reconocimiento
    üîç Detalles: ${errorDetails}
    ‚è∞ Hora: ${timestamp}
    üì± Dispositivo: ${/Mobile|Android|iPhone|iPad/.test(navigator.userAgent) ? 'M√≥vil' : 'Escritorio'}

    Recarga la p√°gina e intenta de nuevo`;
                        break;
                
                    default:
                        errorMessage = `‚ùì Error desconocido
    üîç Detalles: ${errorDetails}
    ‚è∞ Hora: ${timestamp}
    üì± Dispositivo: ${/Mobile|Android|iPhone|iPad/.test(navigator.userAgent) ? 'M√≥vil' : 'Escritorio'}`;
                }
        
                errorDetailsElement.textContent = errorMessage;
                errorModal.classList.remove('hidden');
                errorModal.classList.add('flex');
            }

            // ===== EVENTO DEL BOT√ìN DEL MICR√ìFONO (CON TRACKING) =====
            micButton.addEventListener('click', () => {
                if (!SpeechRecognition || !recognition) {
                    showErrorModal('no_speech_api');
                    return;
                }
                
                if (isRecognizing) {
                    recognition.stop();
                } else {
                    // Registrar inicio solo en la primera pregunta
                    if (currentExerciseIndex === 0 && feedbackMessageElement.textContent === '') {
                        registrarActividad('INICIADO');
                    }
                    
                    try {
                        recognition.start();
                        isRecognizing = true;
                        micButton.classList.remove('bg-red-600', 'repeat-bounce'); // Quitar la animaci√≥n al hacer clic
                        micButton.classList.add('bg-red-500', 'recording-pulse');
                        micButton.disabled = true; // Deshabilita el bot√≥n
                        micButton.textContent = 'HABLA - Estoy escuchando...';
                        feedbackMessageElement.textContent = '';
                        recognizedTextElement.textContent = '';
                        recognizedTextElement.classList.remove('text-red-600', 'text-green-600');
                        recognizedTextElement.classList.add('text-gray-700');
                        playClickSound();
                    } catch (e) {
                        console.error('Error starting speech recognition: ', e);
                        showErrorModal('start_error', e.message);
                    }
                }
            });

            // Funci√≥n para activar autom√°ticamente el micr√≥fono
            function autoStartRecognition() {
                if (!SpeechRecognition || !recognition) {
                    showErrorModal('no_speech_api');
                    return;
                }
                
                // Peque√±o delay para que la interfaz se actualice primero
                setTimeout(() => {
                    try {
                        recognition.start();
                        isRecognizing = true;
                        micButton.classList.remove('bg-red-600');
                        micButton.classList.add('bg-red-500', 'recording-pulse');
                        micButton.disabled = true; // Deshabilita el bot√≥n
                        micButton.textContent = 'HABLA - Estoy escuchando...';
                        playClickSound();
                    } catch (e) {
                        console.error('Error starting auto speech recognition: ', e);
                        showErrorModal('start_error', `Auto-start: ${e.message}`);
                        // Si hay error, deja el bot√≥n normal para que el usuario pueda hacer clic manualmente
                        micButton.innerHTML = `<span>Click & Habla</span>
                            <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                                <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path>
                            </svg>`;
                    }
                }, 500); // Delay de 500ms para una transici√≥n suave
            }

            // Evento para el bot√≥n siguiente/ayuda/repetir (modificado para mostrar m√∫ltiples opciones)
            nextButton.addEventListener('click', () => {
                if (nextButton.textContent === 'Ayuda') {
                    const currentExercise = verbExercises[currentExerciseIndex];
                    const helpText = currentExercise.correctAnswers.join(' / ');
                    recognizedTextElement.textContent = helpText;
                    recognizedTextElement.classList.remove('text-red-600');
                    recognizedTextElement.classList.add('text-green-600');
                    showFeedback('La respuesta correcta es:', true);
                    micButton.classList.remove('hidden');
                    micButton.innerHTML = `<span>Repite - Click</span>
                        <svg class="w-5 h-5" fill="none" stroke="currentColor" viewBox="0 0 24 24" xmlns="http://www.w3.org/2000/svg">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 11a7 7 0 01-7 7m0 0a7 7 0 01-7-7m7 7v4m0 0H8m4 0h4m-4-8a3 3 0 01-3-3V5a3 3 0 116 0v6a3 3 0 01-3 3z"></path>
                        </svg>`;
                    nextButton.disabled = true;
                    nextButton.classList.add('opacity-50', 'cursor-not-allowed');
                } else if (nextButton.textContent === 'Siguiente >') {
                    currentExerciseIndex++;
                    displayCurrentQuestion();
                    // Activar autom√°ticamente el micr√≥fono despu√©s de mostrar la nueva pregunta
                    if (currentExerciseIndex < verbExercises.length) {
                        autoStartRecognition();
                    }
                } else if (nextButton.textContent === 'Repetir el ejercicio') {
                    currentExerciseIndex = 0;
                    shuffleArray(verbExercises);
                    displayCurrentQuestion();
                    // NO activar autom√°ticamente al reiniciar, dejar que el usuario haga clic manualmente
                    // La primera pregunta es mejor que sea manual para dar tiempo al usuario
                }
            });

            // Evento para cerrar el modal de error
            closeModalButton.addEventListener('click', () => {
                errorModal.classList.remove('flex');
                errorModal.classList.add('hidden');
            });
            
            // Inicia el ejercicio
            shuffleArray(verbExercises); // Baraja la lista de ejercicios al inicio
            displayCurrentQuestion();
        });
    </script>
</body>
</html>
